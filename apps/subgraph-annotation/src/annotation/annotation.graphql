extend schema
  @link(url: "https://specs.apollo.dev/federation/v2.7", import: ["@key", "@shareable", "@external", "@authenticated", "@requiresScopes"])

enum AnnotationType {
  TEXT
  SKETCH
  LINK
  BOOKMARK
  SPATIAL_COMMENT
}

enum AnnotationLayer {
  PERSONAL
  SHARED
  INSTRUCTOR
  AI_GENERATED
}

type Annotation @key(fields: "id") {
  id: ID!
  tenantId: ID!
  assetId: ID!
  userId: ID!
  user: User
  annotationType: AnnotationType!
  layer: AnnotationLayer!
  content: JSON!
  spatialData: JSON
  parentId: ID
  parent: Annotation
  isResolved: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type User @key(fields: "id") {
  id: ID!
}

type ContentItem @key(fields: "id") {
  id: ID!
}

type Query {
  _health: String! @shareable
  annotation(id: ID!): Annotation
  annotations(
    assetId: ID
    userId: ID
    layer: AnnotationLayer
    limit: Int = 20
    offset: Int = 0 @deprecated(reason: "Use cursor-based pagination with 'after' argument instead. Will be removed 2026-09-01.")
  ): [Annotation!]!
  annotationsByAsset(assetId: ID!, layer: AnnotationLayer): [Annotation!]!
  annotationsByUser(userId: ID!, limit: Int = 20, offset: Int = 0): [Annotation!]!
}

type Mutation {
  createAnnotation(input: CreateAnnotationInput!): Annotation!
    @authenticated
    @requiresScopes(scopes: ["write:annotations"])
  updateAnnotation(id: ID!, input: UpdateAnnotationInput!): Annotation!
    @authenticated
    @requiresScopes(scopes: ["write:annotations"])
  deleteAnnotation(id: ID!): Boolean!
    @authenticated
    @requiresScopes(scopes: ["write:annotations"])
  resolveAnnotation(id: ID!): Annotation!
    @authenticated
    @requiresScopes(scopes: ["write:annotations"])
  replyToAnnotation(annotationId: ID!, content: String!): Annotation!
    @authenticated
    @requiresScopes(scopes: ["write:annotations"])
}

type Subscription {
  """Subscribe to new annotations on a specific asset in real-time"""
  annotationAdded(assetId: ID!): Annotation!
}

input CreateAnnotationInput {
  assetId: ID!
  annotationType: AnnotationType!
  layer: AnnotationLayer = PERSONAL
  content: JSON!
  spatialData: JSON
  parentId: ID
}

input UpdateAnnotationInput {
  content: JSON
  spatialData: JSON
  isResolved: Boolean
}

scalar DateTime
scalar JSON
