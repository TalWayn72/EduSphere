extend schema
  @link(url: "https://specs.apollo.dev/federation/v2.7", import: ["@key", "@shareable", "@external"])

enum AnnotationType {
  TEXT
  SKETCH
  LINK
  BOOKMARK
  SPATIAL_COMMENT
}

enum AnnotationLayer {
  PERSONAL
  SHARED
  INSTRUCTOR
  AI_GENERATED
}

type Annotation @key(fields: "id") {
  id: ID!
  tenantId: ID!
  assetId: ID!
  userId: ID!
  user: User
  annotationType: AnnotationType!
  layer: AnnotationLayer!
  content: JSON!
  spatialData: JSON
  parentId: ID
  parent: Annotation
  isResolved: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type User @key(fields: "id") {
  id: ID!
}

type ContentItem @key(fields: "id") {
  id: ID!
}

type Query {
  _health: String! @shareable
  annotation(id: ID!): Annotation
  annotations(
    assetId: ID
    userId: ID
    layer: AnnotationLayer
    limit: Int = 20
    offset: Int = 0
  ): [Annotation!]!
  annotationsByAsset(assetId: ID!, layer: AnnotationLayer): [Annotation!]!
  annotationsByUser(userId: ID!, limit: Int = 20, offset: Int = 0): [Annotation!]!
}

type Mutation {
  createAnnotation(input: CreateAnnotationInput!): Annotation!
  updateAnnotation(id: ID!, input: UpdateAnnotationInput!): Annotation!
  deleteAnnotation(id: ID!): Boolean!
  resolveAnnotation(id: ID!): Annotation!
}

input CreateAnnotationInput {
  assetId: ID!
  annotationType: AnnotationType!
  layer: AnnotationLayer = PERSONAL
  content: JSON!
  spatialData: JSON
  parentId: ID
}

input UpdateAnnotationInput {
  content: JSON
  spatialData: JSON
  isResolved: Boolean
}

scalar DateTime
scalar JSON
