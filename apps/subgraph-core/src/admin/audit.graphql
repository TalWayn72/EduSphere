extend schema
  @link(url: "https://specs.apollo.dev/federation/v2.7", import: ["@key", "@shareable", "@authenticated"])

type AuditLogEntry {
  id: ID!
  tenantId: ID!
  userId: ID
  action: String!
  resourceType: String
  resourceId: ID
  status: String!
  ipAddress: String
  requestId: String
  createdAt: String!
  metadata: String
}

type AuditLogResult {
  entries: [AuditLogEntry!]!
  total: Int!
}

enum AuditExportFormat {
  CSV
  JSON
}

type AuditExportResult {
  presignedUrl: String!
  expiresAt: String!
  recordCount: Int!
}

extend type Query {
  adminAuditLog(
    limit: Int = 50
    offset: Int = 0
    action: String
    userId: ID
    since: String
    until: String
  ): AuditLogResult!
    @authenticated
    @requiresRole(roles: [ORG_ADMIN, SUPER_ADMIN])
}

extend type Mutation {
  exportAuditLog(
    fromDate: String!
    toDate: String!
    format: AuditExportFormat! = CSV
  ): AuditExportResult!
    @authenticated
    @requiresRole(roles: [ORG_ADMIN, SUPER_ADMIN])

  scheduleGdprErasure(userId: ID!): Boolean!
    @authenticated
    @requiresRole(roles: [ORG_ADMIN, SUPER_ADMIN])
}
