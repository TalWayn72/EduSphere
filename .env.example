# ═══════════════════════════════════════════════════════════════
# EduSphere Environment Configuration Template
# ═══════════════════════════════════════════════════════════════
# Copy this file to .env and fill in your values
# NEVER commit .env to version control

# ──────────────────────────────────────────────────────────────
# NODE ENVIRONMENT
# ──────────────────────────────────────────────────────────────
NODE_ENV=development

# ──────────────────────────────────────────────────────────────
# DATABASE (PostgreSQL 16 + Apache AGE + pgvector)
# ──────────────────────────────────────────────────────────────
DATABASE_URL=postgresql://edusphere:edusphere_dev_password@localhost:5432/edusphere
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USER=edusphere
DATABASE_PASSWORD=edusphere_dev_password
DATABASE_NAME=edusphere
DATABASE_SSL=false
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# Read Replica (optional — falls back to primary if not set)
REPLICA_DATABASE_URL=

# ── PgBouncer — Connection Pooler (transaction mode, port 5433) ──────────────
# Use PGBOUNCER_URL for standard Drizzle ORM queries (high-concurrency
# workloads). PgBouncer multiplexes up to 1000 client connections onto
# 25 server connections, preventing PostgreSQL connection exhaustion.
#
# IMPORTANT: Do NOT route Apache AGE Cypher queries or any query that
# uses SET LOCAL / LISTEN / advisory locks through PgBouncer (transaction
# pool mode drops session state). Always use DATABASE_URL for those.
#
# Dev:  PgBouncer is a separate Docker service on port 5433 (docker-compose.dev.yml).
# Prod: PgBouncer runs as a sidecar or dedicated service on port 5433.
PGBOUNCER_URL=postgresql://edusphere:edusphere_dev_password@localhost:5433/edusphere
PGBOUNCER_HOST=localhost
PGBOUNCER_PORT=5433

# Apache AGE Graph Database
AGE_GRAPH_NAME=edusphere_graph

# ──────────────────────────────────────────────────────────────
# AUTHENTICATION (Keycloak OIDC)
# ──────────────────────────────────────────────────────────────
KEYCLOAK_URL=http://localhost:8080
KEYCLOAK_REALM=edusphere
KEYCLOAK_CLIENT_ID=edusphere-backend
KEYCLOAK_CLIENT_SECRET=your-client-secret-here
KEYCLOAK_JWKS_URL=http://localhost:8080/realms/edusphere/protocol/openid-connect/certs
JWT_ISSUER=http://localhost:8080/realms/edusphere
JWT_AUDIENCE=edusphere-backend

# ──────────────────────────────────────────────────────────────
# GRAPHQL FEDERATION
# ──────────────────────────────────────────────────────────────
# Gateway
GATEWAY_PORT=4000
GATEWAY_HOST=0.0.0.0
HIVE_TOKEN=your-graphql-hive-token-here
HIVE_REGISTRY_URL=https://app.graphql-hive.com/graphql

# Subgraphs
SUBGRAPH_CORE_URL=http://localhost:4001/graphql
SUBGRAPH_CONTENT_URL=http://localhost:4002/graphql
SUBGRAPH_ANNOTATION_URL=http://localhost:4003/graphql
SUBGRAPH_COLLABORATION_URL=http://localhost:4004/graphql
SUBGRAPH_AGENT_URL=http://localhost:4005/graphql
SUBGRAPH_KNOWLEDGE_URL=http://localhost:4006/graphql

# ──────────────────────────────────────────────────────────────
# NATS JETSTREAM (Event-Driven Messaging)
# ──────────────────────────────────────────────────────────────
NATS_URL=nats://localhost:4222
NATS_USER=edusphere
NATS_PASSWORD=edusphere_nats_password
NATS_STREAM_NAME=EDUSPHERE
NATS_MAX_RECONNECT=10
NATS_RECONNECT_TIME_WAIT=2000

# ──────────────────────────────────────────────────────────────
# OBJECT STORAGE (MinIO S3-compatible)
# ──────────────────────────────────────────────────────────────
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_USE_SSL=false
MINIO_BUCKET_NAME=edusphere
MINIO_REGION=us-east-1

# ──────────────────────────────────────────────────────────────
# REDIS (Caching & Sessions)
# ──────────────────────────────────────────────────────────────
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=edusphere_redis_password
REDIS_DB=0
REDIS_TTL=3600

# ──────────────────────────────────────────────────────────────
# AI/ML SERVICES
# ──────────────────────────────────────────────────────────────
# Ollama (Local LLM)
OLLAMA_URL=http://localhost:11434
OLLAMA_MODEL=llama3.1:8b

# Vercel AI SDK
VERCEL_AI_API_KEY=your-vercel-ai-key-here

# OpenAI (Optional - for production embeddings)
OPENAI_API_KEY=your-openai-key-here
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# ──────────────────────────────────────────────────────────────
# OBSERVABILITY & MONITORING
# ──────────────────────────────────────────────────────────────
# Jaeger (OpenTelemetry Tracing)
JAEGER_ENDPOINT=http://localhost:4318
OTEL_SERVICE_NAME=edusphere
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318

# Prometheus Metrics
PROMETHEUS_PORT=9090

# Logging
LOG_LEVEL=debug
LOG_PRETTY=true

# ──────────────────────────────────────────────────────────────
# FRONTEND (React Web App)
# ──────────────────────────────────────────────────────────────
VITE_GRAPHQL_URL=http://localhost:4000/graphql
VITE_GRAPHQL_WS_URL=ws://localhost:4000/graphql
VITE_KEYCLOAK_URL=http://localhost:8080
VITE_KEYCLOAK_REALM=edusphere
VITE_KEYCLOAK_CLIENT_ID=edusphere-web

# ──────────────────────────────────────────────────────────────
# MOBILE (Expo React Native)
# ──────────────────────────────────────────────────────────────
EXPO_PUBLIC_GRAPHQL_URL=http://10.0.2.2:4000/graphql
EXPO_PUBLIC_GRAPHQL_WS_URL=ws://10.0.2.2:4000/graphql
EXPO_PUBLIC_KEYCLOAK_URL=http://10.0.2.2:8080
EXPO_PUBLIC_KEYCLOAK_REALM=edusphere
EXPO_PUBLIC_KEYCLOAK_CLIENT_ID=edusphere-mobile

# ──────────────────────────────────────────────────────────────
# SECURITY
# ──────────────────────────────────────────────────────────────
CORS_ORIGIN=http://localhost:5173,http://localhost:3000
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
SESSION_SECRET=your-session-secret-change-in-production
ENCRYPTION_KEY=your-32-char-encryption-key-here

# ──────────────────────────────────────────────────────────────
# FEATURE FLAGS
# ──────────────────────────────────────────────────────────────
ENABLE_GRAPHQL_PLAYGROUND=true
ENABLE_INTROSPECTION=true
ENABLE_TRACING=true
ENABLE_AI_AGENTS=true
ENABLE_TRANSCRIPTION=true
ENABLE_GRAPH_SEARCH=true

# ──────────────────────────────────────────────────────────────
# TESTING
# ──────────────────────────────────────────────────────────────
TEST_DATABASE_URL=postgresql://edusphere:edusphere_test_password@localhost:5433/edusphere_test
TEST_REDIS_HOST=localhost
TEST_REDIS_PORT=6380

# ──────────────────────────────────────────────────────────────
# SECURITY — ENCRYPTION & TLS (G-07 / G-16 / G-17)
# ──────────────────────────────────────────────────────────────

# G-17: MinIO Server-Side Encryption Key (must be >= 32 chars, base64-encoded preferred)
# The docker-compose env var references this as: edusphere-encryption-key:# Generate with: openssl rand -base64 32
MINIO_ENCRYPTION_KEY=CHANGE_ME_REPLACE_WITH_32_CHAR_MIN_RANDOM_KEY

# G-16: NATS TLS Certificate paths (leave empty for dev without mTLS)
# In production set all three to enable mutual TLS between services and NATS.
NATS_TLS_CERT=
NATS_TLS_KEY=
NATS_TLS_CA=
# NATS NKey seed (alternative to username/password auth in production)
NATS_NKEY=

# G-07: Database SSL Mode
# Development: sslmode=prefer  (connects with or without SSL — safe for local docker)
# Production:  sslmode=require (rejects plain-text connections — required in prod)
# Example prod URL:
# DATABASE_URL=postgresql://edusphere:PASS@db.example.com:5432/edusphere?sslmode=require
